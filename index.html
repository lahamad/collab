<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SWAG — Fashion Shopping Store</title>

<!-- Storm Gust style font (hosted) -->
<link href="https://fonts.cdnfonts.com/css/storm-gust" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- Three.js -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<style>
  :root{
    --bg-black:#05050a;
    --panel:#0f0f14;
    --skin:#f4d8c2;
    --muted:#bfc3c9;
    --accent1:#ff4444;   /* red */
    --accent2:#0b0b0f;   /* black/dark */
    --accent3:#7c5cff;   /* purple pop */
    --success:#16a34a;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:
    radial-gradient(900px 400px at 10% 10%, rgba(124,92,255,.04), transparent 18%),
    linear-gradient(180deg,var(--bg-black), #07070b 40%, rgba(0,0,0,.65) 70%),
    linear-gradient(180deg, var(--skin), #fff 30%); color:#eef2f7; -webkit-font-smoothing:antialiased;}

  /* --- Header --- */
  header.topbar{position:sticky;top:0;z-index:120;background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.12));backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,.03)}
  .topbar-inner{max-width:1280px;margin:0 auto;display:flex;align-items:center;gap:16px;padding:14px}

  .brand {
    display:flex;gap:10px;align-items:center;cursor:pointer;
  }
  .logo {
    width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent1),#0b0b0b);
    display:grid;place-items:center;font-weight:900;color:#fff;font-family:'Storm Gust',sans-serif;font-size:22px;
    box-shadow:0 8px 24px rgba(124,92,255,.12);
  }
  .brand-title {
    font-family:'Storm Gust',sans-serif;
    font-size:34px;line-height:1;
    background:linear-gradient(90deg,var(--accent1),#000);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:800;
    color: #fff;
  }

  .spacer{flex:1}

  /* search centered */
  .search-wrap{display:flex;flex:1;justify-content:center}
  .search { width:60%; max-width:720px; min-width:260px; position:relative; }
  .search input{
    width:100%; padding:14px 48px;border-radius:999px;background:linear-gradient(180deg,#0b0b0f,#111);border:1px solid rgba(255,255,255,.06);
    color: #fff; font-size:15px; outline:none;
    box-shadow: 0 8px 30px rgba(0,0,0,.6);
  }
  .search svg { position:absolute; left:16px; top:50%; transform:translateY(-50%); opacity:.85; }

  .icons { display:flex; gap:10px; align-items:center; }
  .icon-btn{ background:#0e0e14; padding:9px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.04); color:var(--muted); cursor:pointer; font-weight:700;}
  .cart-count{ background:var(--accent1); color:#fff; padding:4px 8px; border-radius:999px; margin-left:8px; font-weight:800; }

  /* --- nav row --- */
  .nav-row { max-width:1280px; margin:14px auto 8px; padding:10px 18px; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }
  .nav-item{ padding:8px 14px; border-radius:999px; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.04); color:var(--muted); font-weight:700; cursor:pointer;}
  .nav-item:hover{ background:linear-gradient(90deg, rgba(124,92,255,.12), rgba(34,211,238,.06)); color:#fff; transform:translateY(-3px); transition:all .18s ease; }

  /* --- slider ads --- */
  .slider { max-width:1280px; margin:18px auto; padding:8px 12px; overflow:hidden; }
  .slides { display:flex; gap:12px; animation: scroll 28s linear infinite; align-items:center; }
  .slide { min-width:300px; height:160px; border-radius:12px; overflow:hidden; box-shadow:0 8px 36px rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.04); }
  .slide img{ width:100%;height:100%;object-fit:cover; display:block; }
  @keyframes scroll { from { transform:translateX(0) } to { transform:translateX(-50%) } }

  /* --- hero 3d viewer --- */
  .hero { max-width:1280px; margin:22px auto; display:grid; grid-template-columns:1fr 520px; gap:20px; align-items:center; padding:0 12px; }
  .hero-left { color: #fff; padding:20px; }
  .hero-left h1 { font-size:36px; margin:0 0 10px; font-weight:800; color:#fff; }
  .hero-left p { color:var(--muted); margin:0 0 20px; }
  .viewer-card { background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border-radius:14px; padding:14px; display:grid; gap:12px; justify-items:center; box-shadow:0 12px 36px rgba(0,0,0,.6); }
  #viewer3d { width:480px; height:420px; border-radius:12px; background:linear-gradient(180deg,#07070a,#0b0b10); display:block; }

  /* --- product grid --- */
  .grid { max-width:1280px; margin:18px auto 60px; padding:0 12px; display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:18px; }
  .card { background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.005)); border:1px solid rgba(255,255,255,.04); border-radius:12px; overflow:hidden; box-shadow:0 10px 40px rgba(0,0,0,.6); cursor:pointer; display:flex; flex-direction:column; transition: transform .22s ease, box-shadow .22s ease; }
  .card:hover{ transform: translateY(-8px); box-shadow:0 20px 60px rgba(0,0,0,.7); }
  .card img{ width:100%; height:260px; object-fit:cover; display:block; }
  .meta{ padding:12px; display:flex; flex-direction:column; gap:6px; color:var(--muted); }
  .meta .title{ font-weight:800; color:#fff; font-size:15px; }
  .meta .brand{ color:var(--muted); font-size:13px; }
  .meta .price{ font-weight:900; color:var(--accent1); }
  .meta .offer{ color:var(--success); font-weight:800; font-size:12px; }

  /* --- modal --- */
  .modal { position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.6); z-index:300; }
  .modal.open{ display:grid; }
  .modal-card { width:min(920px,96vw); background:#0b0b10; border-radius:12px; padding:12px; border:1px solid rgba(255,255,255,.04); box-shadow:0 30px 80px rgba(0,0,0,.7); color:#fff; }
  .modal-grid { display:grid; grid-template-columns: 1fr 320px; gap:12px; }
  .gallery { display:flex; flex-direction:column; gap:8px; }
  .gallery-main { height:420px; border-radius:8px; overflow:hidden; background:#06060a; display:grid; place-items:center; }
  .gallery-main img{ width:100%; height:100%; object-fit:cover; }
  .gallery-thumbs { display:flex; gap:8px; margin-top:8px; }
  .thumb{ width:72px; height:72px; border-radius:8px; overflow:hidden; border:2px solid transparent; cursor:pointer; }
  .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
  .thumb.active{ border-color:var(--accent3); }

  .modal-side { padding:8px; display:flex; flex-direction:column; gap:10px; }
  .modal-side h2{ margin:0; font-size:20px; color:#fff; }
  .modal-side .price{ font-size:18px; color:var(--accent1); font-weight:900; }
  .modal-actions{ display:flex; gap:8px; margin-top:10px; }
  .btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,.06); color:#fff; padding:10px 12px; border-radius:10px; cursor:pointer; }
  .btn-primary{ background:linear-gradient(90deg,var(--accent3),var(--accent1)); color:#06060a; padding:10px 14px; border-radius:10px; border:none; font-weight:800; cursor:pointer; }

  /* footer */
  footer.site-foot { max-width:1280px; margin:40px auto; padding:18px; color:var(--muted); display:flex; align-items:center; justify-content:space-between; gap:12px; }
  footer .links{ display:flex; gap:8px; align-items:center; }

  @media (max-width:980px){
    .hero { grid-template-columns:1fr; }
    #viewer3d { width:100%; height:360px; }
    .search { width:82%; }
  }
  @media (max-width:560px){
    .brand-title{ font-size:26px; }
    .search { width:92%;}
    .slides{ animation:none; overflow-x:auto; }
  }
</style>
</head>
<body>

<!-- TOPBAR -->
<header class="topbar" role="banner">
  <div class="topbar-inner">
    <div class="brand" title="SWAG">
      <div class="logo">S</div>
      <div class="brand-title">SWAG</div>
    </div>

    <div class="search-wrap" aria-hidden="false">
      <div class="search" role="search">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="color:#fff"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.6"/></svg>
        <input id="searchInput" placeholder="Search jackets, shirts, kurta, suits, brands..." autocomplete="off" />
      </div>
    </div>

    <div class="spacer"></div>

    <div class="icons" role="navigation" aria-label="Quick actions">
      <button id="openCart" class="icon-btn">Cart <span id="cartCount" class="cart-count">0</span></button>
      <button id="openContact" class="icon-btn">Contact</button>
    </div>
  </div>
</header>

<!-- NAV ROW -->
<nav class="nav-row" role="navigation" aria-label="Main nav">
  <div class="nav-item">Home</div>
  <div class="nav-item">Filters</div>
  <div class="nav-item">Size</div>
  <div class="nav-item">Menu</div>
  <div class="nav-item">Price</div>
  <div class="nav-item">Customer Service</div>
  <div class="nav-item">Sales</div>
</nav>

<!-- SLIDER ADS -->
<section class="slider" aria-hidden="false">
  <div class="slides" id="slides">
    <!-- repeated slides; animation will scroll -->
    <div class="slide"><img src="https://source.unsplash.com/900x600/?mens-fashion,runway" alt=""></div>
    <div class="slide"><img src="https://source.unsplash.com/910x600/?mens-jacket,street" alt=""></div>
    <div class="slide"><img src="https://source.unsplash.com/920x600/?ethnic,men" alt=""></div>
    <div class="slide"><img src="https://source.unsplash.com/930x600/?mens-suit,formal" alt=""></div>
    <div class="slide"><img src="https://source.unsplash.com/940x600/?tshirt,men" alt=""></div>
    <!-- duplicate block to make the scroll loop look continuous -->
    <div class="slide"><img src="https://source.unsplash.com/900x600/?mens-fashion,show" alt=""></div>
    <div class="slide"><img src="https://source.unsplash.com/910x600/?mens-jacket,urban" alt=""></div>
  </div>
</section>

<!-- HERO: left text + 3D viewer on right -->
<section class="hero" aria-labelledby="heroTitle">
  <div class="hero-left">
    <h1 id="heroTitle">Modern Men’s Fashion — SWAG</h1>
    <p>Curated costumes, premium fabrics, exclusive offers. Rotate the 3D tee to preview textures. Click any product to open gallery & details.</p>
    <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap;">
      <button class="btn-primary" style="padding:10px 16px">Shop New Arrivals</button>
      <button class="btn-ghost" id="openOrders">Orders</button>
    </div>
  </div>

  <div class="viewer-card" aria-live="polite">
    <div style="display:flex;gap:10px;align-items:center;width:100%;justify-content:space-between;">
      <div style="font-weight:800;color:#fff">3D T-Shirt Preview</div>
      <div style="display:flex;gap:8px">
        <button id="spinToggle" class="btn-ghost">Pause</button>
      </div>
    </div>

    <!-- three.js canvas -->
    <canvas id="viewer3d"></canvas>
    <div style="font-size:13px;color:var(--muted)">Texture uses product image preview — click any product to load its texture</div>
  </div>
</section>

<!-- PRODUCT GRID (rendered incrementally) -->
<main id="grid" class="grid" aria-live="polite" aria-label="Products"></main>

<!-- PRODUCT MODAL -->
<div id="productModal" class="modal" role="dialog" aria-hidden="true">
  <div class="modal-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:800">Product details</div>
      <button id="closeModal" class="btn-ghost">✕</button>
    </div>

    <div class="modal-grid">
      <div>
        <div class="gallery">
          <div class="gallery-main" id="galleryMain"><img src="" alt="Product image" id="galleryMainImg"></div>
          <div class="gallery-thumbs" id="galleryThumbs"></div>
        </div>
      </div>

      <div class="modal-side">
        <h2 id="modalTitle">Title</h2>
        <div class="brand" style="font-size:14px;color:var(--muted);font-family:Inter, sans-serif;font-weight:600" id="modalBrand">Brand</div>
        <div class="price" id="modalPrice">₹0</div>
        <div class="meta" id="modalMeta" style="color:var(--muted)">Sizes: S M L XL • Category: Casual</div>
        <div class="modal-actions">
          <button id="addToCart" class="btn-primary">Add to cart</button>
          <button id="buyNow" class="btn-ghost">Buy now</button>
        </div>
        <div style="margin-top:8px;color:var(--muted);font-size:13px">Offers: <span id="modalOffer" style="color:var(--success);font-weight:800"></span></div>
      </div>
    </div>
  </div>
</div>

<!-- CART / CONTACT / ORDERS modals (simplified) -->
<div id="cartModal" class="modal" role="dialog" aria-hidden="true">
  <div class="modal-card small">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:800">My Cart</div>
      <button id="closeCart" class="btn-ghost">✕</button>
    </div>
    <div style="margin-top:12px" id="cartBody"></div>
    <div style="display:flex;gap:8px;margin-top:14px">
      <button id="checkoutBtn" class="btn-primary">Checkout (Demo)</button>
      <button id="clearCart" class="btn-ghost">Clear</button>
    </div>
  </div>
</div>

<div id="contactModal" class="modal" role="dialog" aria-hidden="true">
  <div class="modal-card small">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:800">Contact Us</div>
      <button id="closeContact" class="btn-ghost">✕</button>
    </div>
    <form id="contactForm" style="margin-top:12px;display:grid;gap:8px">
      <input placeholder="Your name" required />
      <input placeholder="Email" type="email" required />
      <textarea placeholder="Message" rows="4" required></textarea>
      <div style="display:flex;gap:8px"><button type="submit" class="btn-primary">Send</button><button type="button" id="cancelContact" class="btn-ghost">Cancel</button></div>
    </form>
  </div>
</div>

<footer class="site-foot" role="contentinfo">
  <div style="color:var(--muted)">© 2025 SWAG — Real business frontend demo</div>
  <div class="links">
    <button id="openCartFooter" class="btn-ghost">Cart</button>
    <button id="openOrdersFooter" class="btn-ghost">Orders</button>
    <button id="openContactFooter" class="btn-ghost">Contact</button>
  </div>
</footer>

<script>
/* ---------------------- App logic (all in one) ---------------------- */

/* CONFIG */
const PRODUCT_COUNT = 500;    // generate 500 unique products (you asked 500+)
const initialPage = 0;
const PAGE_SIZE = 48;         // incremental render to keep responsive

/* Utilities */
const rand = (a,b) => Math.floor(Math.random()*(b-a+1))+a;
const pick = arr => arr[Math.floor(Math.random()*arr.length)];
const escapeHtml = s => String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));

/* Generate product data with unique images (Unsplash source + sig) */
const categories = ['Formal','Casual','Ethnic','Street','Active','Athleisure','Lounge'];
const sizes = ['XS','S','M','L','XL','XXL'];
const brands = ['Aristo', 'NoirCraft', 'Linea', 'Hearth', 'Crest & Co', 'Kairo', 'Nexon', 'VogueMen', 'TailorX', 'MODA'];

const PRODUCTS = Array.from({length: PRODUCT_COUNT}).map((_,i) => {
  const id = 'p-' + (i+1);
  const brand = brands[i % brands.length];
  const category = categories[i % categories.length];
  const name = `${brand} ${['Jacket','Kurta','Tuxedo','Tee','Tracksuit','Denim','Blazer','Shirt'][i % 8]} ${i+1}`;
  const basePrice = rand(699,12999);
  const deal = Math.random() < 0.6 ? rand(8,45) : 0;
  // create 4 unique images per product using different sig offsets & queries to make them visually different
  const query = encodeURIComponent((category + ' men fashion').replace(/\s+/g,'+'));
  const imgs = [
    `https://source.unsplash.com/900x900/?${query}&sig=${i+1}`,
    `https://source.unsplash.com/900x900/?${query},mens-style&sig=${i+101}`,
    `https://source.unsplash.com/900x900/?${query},fabric&sig=${i+201}`,
    `https://source.unsplash.com/900x900/?${query},front&sig=${i+301}`
  ];
  return { id, brand, name, category, sizes: sizes.slice(0, rand(3,6)), imgs, priceINR: basePrice, priceUSD: Math.round(basePrice/82), priceEUR: Math.round(basePrice/88), deal, caption: 'Premium fabric, tailored fit.' };
});

/* DOM refs */
const grid = document.getElementById('grid');
const cartCountEl = document.getElementById('cartCount');
const productModal = document.getElementById('productModal');
const galleryMainImg = document.getElementById('galleryMainImg');
const galleryThumbs = document.getElementById('galleryThumbs');
const modalTitle = document.getElementById('modalTitle');
const modalBrand = document.getElementById('modalBrand');
const modalPrice = document.getElementById('modalPrice');
const modalOffer = document.getElementById('modalOffer');
const modalMeta = document.getElementById('modalMeta');
const addToCartBtn = document.getElementById('addToCart');
const buyNowBtn = document.getElementById('buyNow');

/* Cart (localStorage) */
const CART_KEY = 'swag_cart_v1';
function loadCart(){ return JSON.parse(localStorage.getItem(CART_KEY) || '{}'); }
function saveCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); updateCartUI(); }
function addToCart(id){ const c = loadCart(); c[id] = (c[id]||0) + 1; saveCart(c); }
function removeFromCart(id){ const c = loadCart(); delete c[id]; saveCart(c); }
function updateCartUI(){ const c = loadCart(); const total = Object.values(c).reduce((s,v)=>s+v,0); cartCountEl.textContent = total; }

/* Incremental render to keep page responsive */
let currentPage = 0;
function renderNextPage(list){
  const start = currentPage * PAGE_SIZE;
  const slice = list.slice(start, start + PAGE_SIZE);
  if(!slice.length) return;
  const frag = document.createDocumentFragment();
  slice.forEach(p => {
    const card = document.createElement('article');
    card.className = 'card';
    card.dataset.id = p.id;
    card.innerHTML = `
      <img loading="lazy" src="${p.imgs[0]}" alt="${escapeHtml(p.name)}">
      <div class="meta">
        <div class="title">${escapeHtml(p.name)}</div>
        <div class="brand">${escapeHtml(p.brand)} • ${escapeHtml(p.category)}</div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="price">₹${p.priceINR.toLocaleString()} ${p.deal?`<span class="offer">${p.deal}% OFF</span>`:''}</div>
        </div>
      </div>
    `;
    // click opens modal
    card.addEventListener('click', ()=> openProductModal(p));
    frag.appendChild(card);
  });
  grid.appendChild(frag);
  currentPage++;
}

/* initial render */
renderNextPage(PRODUCTS);

/* infinite scroll to load more until all products displayed */
let loadingMore = false;
window.addEventListener('scroll', () => {
  if(loadingMore) return;
  if(window.innerHeight + window.scrollY > document.body.offsetHeight - 1200){
    if(currentPage * PAGE_SIZE < PRODUCTS.length){
      loadingMore = true;
      setTimeout(()=>{ renderNextPage(PRODUCTS); loadingMore = false; }, 300);
    }
  }
});

/* Product modal logic (show multi images + details) */
let activeProduct = null;
function openProductModal(product){
  activeProduct = product;
  modalTitle.textContent = product.name;
  modalBrand.textContent = product.brand + ' • ' + product.category;
  modalPrice.textContent = `₹${product.priceINR.toLocaleString()}`;
  modalOffer.textContent = product.deal ? `${product.deal}%` : 'No offer';
  modalMeta.textContent = `Sizes: ${product.sizes.join(' ')} • SKU: ${product.id}`;
  // gallery
  galleryMainImg.src = product.imgs[0];
  galleryThumbs.innerHTML = '';
  product.imgs.forEach((src,idx) => {
    const t = document.createElement('div'); t.className = 'thumb' + (idx===0 ? ' active':'');
    t.innerHTML = `<img src="${src}" alt="thumb ${idx+1}" loading="lazy">`;
    t.addEventListener('click', ()=> { document.querySelectorAll('.thumb').forEach(x=>x.classList.remove('active')); t.classList.add('active'); galleryMainImg.src = src; });
    galleryThumbs.appendChild(t);
  });
  productModal.classList.add('open'); productModal.setAttribute('aria-hidden','false');
}

/* modal close */
document.getElementById('closeModal').addEventListener('click', ()=> { productModal.classList.remove('open'); productModal.setAttribute('aria-hidden','true'); });
addToCartBtn.addEventListener('click', ()=> { if(activeProduct){ addToCart(activeProduct.id); alert('Added to cart'); }});
buyNowBtn.addEventListener('click', ()=> { if(activeProduct){ addToCart(activeProduct.id); alert('Proceed to payment (demo)'); }});

/* Cart modal control */
const cartModal = document.getElementById('cartModal');
document.getElementById('openCart').addEventListener('click', ()=> { renderCart(); cartModal.classList.add('open'); cartModal.setAttribute('aria-hidden','false'); });
document.getElementById('openCartFooter').addEventListener('click', ()=> { renderCart(); cartModal.classList.add('open'); cartModal.setAttribute('aria-hidden','false'); });
document.getElementById('closeCart').addEventListener('click', ()=> { cartModal.classList.remove('open'); cartModal.setAttribute('aria-hidden','true'); });

function renderCart(){
  const body = document.getElementById('cartBody');
  const c = loadCart();
  if(!Object.keys(c).length){ body.innerHTML = '<div style="color:var(--muted)">Cart is empty</div>'; return; }
  let html = '<div style="display:grid;gap:12px">';
  let total = 0;
  for(const id of Object.keys(c)){
    const qty = c[id];
    const p = PRODUCTS.find(x=>x.id===id);
    const line = p.priceINR * qty; total += line;
    html += `<div style="display:flex;gap:10px;align-items:center">
      <img src="${p.imgs[0]}" style="width:72px;height:72px;object-fit:cover;border-radius:8px" />
      <div style="flex:1">
        <div style="font-weight:800">${escapeHtml(p.name)}</div>
        <div style="color:var(--muted);font-size:13px">${escapeHtml(p.brand)} • ${qty} × ₹${p.priceINR.toLocaleString()}</div>
      </div>
      <div><button data-id="${id}" class="btn-ghost remove-btn">Remove</button></div>
    </div>`;
  }
  html += `<div style="font-weight:900;margin-top:6px">Total: ₹${total.toLocaleString()}</div></div>`;
  body.innerHTML = html;
  body.querySelectorAll('.remove-btn').forEach(b => b.addEventListener('click', e => { removeFromCart(e.target.dataset.id); renderCart(); }));
}
document.getElementById('checkoutBtn').addEventListener('click', ()=> { alert('Checkout placeholder — integrate payment backend'); });
document.getElementById('clearCart').addEventListener('click', ()=> { saveCart({}); renderCart(); });

/* Contact modal */
const contactModal = document.getElementById('contactModal');
document.getElementById('openContact').addEventListener('click', ()=> { contactModal.classList.add('open'); contactModal.setAttribute('aria-hidden','false'); });
document.getElementById('openContactFooter').addEventListener('click', ()=> { contactModal.classList.add('open'); contactModal.setAttribute('aria-hidden','false'); });
document.getElementById('closeContact').addEventListener('click', ()=> { contactModal.classList.remove('open'); contactModal.setAttribute('aria-hidden','true'); });
document.getElementById('cancelContact').addEventListener('click', ()=> { contactModal.classList.remove('open'); contactModal.setAttribute('aria-hidden','true'); });
document.getElementById('contactForm').addEventListener('submit', (e)=> { e.preventDefault(); alert('Thanks — we received your message (demo).'); contactModal.classList.remove('open'); contactModal.setAttribute('aria-hidden','true'); });

/* Orders placeholder */
document.getElementById('openOrders').addEventListener('click', ()=> alert('Orders page placeholder — connect your backend.'));
document.getElementById('openOrdersFooter').addEventListener('click', ()=> alert('Orders page placeholder — connect your backend.'));

updateCartUI();

/* Search quick filter */
document.getElementById('searchInput').addEventListener('input', (e) => {
  const q = e.target.value.trim().toLowerCase();
  // naive local filter: re-render first N matches
  if(!q){ grid.innerHTML=''; currentPage=0; renderNextPage(PRODUCTS); return; }
  const matches = PRODUCTS.filter(p => (p.name + ' ' + p.brand + ' ' + p.category + ' ' + p.caption).toLowerCase().includes(q));
  grid.innerHTML=''; currentPage=0;
  // render top matches up to total (but incremental still)
  renderNextPage(matches);
  // replace activeList for infinite scroll
  // quick hack: when search active, set PRODUCTS_SNAPSHOT to matches
  PRODUCTS_SNAPSHOT = matches;
});

/* keep an alternate list when searching */
let PRODUCTS_SNAPSHOT = PRODUCTS.slice();

/* Infinite scroll uses PRODUCTS_SNAPSHOT (current working list) */
window.addEventListener('scroll', () => {
  if(window.innerHeight + window.scrollY > document.body.offsetHeight - 1200){
    if(currentPage * PAGE_SIZE < PRODUCTS_SNAPSHOT.length) renderNextPage(PRODUCTS_SNAPSHOT);
  }
});

/* 3D viewer: textured box that can be updated with product image */
(() => {
  const canvas = document.getElementById('viewer3d');
  const renderer = new THREE.WebGLRenderer({ canvas, alpha:true, antialias:true });
  function resize() {
    const w = canvas.clientWidth, h = canvas.clientHeight;
    if(canvas.width !== w || canvas.height !== h){
      renderer.setSize(w,h,true);
      camera.aspect = w/h; camera.updateProjectionMatrix();
    }
  }
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(45, 480/420, 0.1, 100);
  camera.position.set(0,0.6,2.8);
  const hemi = new THREE.HemisphereLight(0xffffff, 0x111122, 1.2); scene.add(hemi);
  const dir = new THREE.DirectionalLight(0xffffff, 1); dir.position.set(3,3,3); scene.add(dir);
  const geometry = new THREE.BoxGeometry(1.5,2.1,0.5);
  const defaultTex = new THREE.TextureLoader().load('https://source.unsplash.com/900x900/?tshirt&sig=99');
  let material = new THREE.MeshStandardMaterial({ map: defaultTex });
  const mesh = new THREE.Mesh(geometry, material);
  scene.add(mesh);
  let spinning = true;
  document.getElementById('spinToggle').addEventListener('click', (e)=>{ spinning = !spinning; e.target.textContent = spinning ? 'Pause' : 'Resume'; });
  function animate(){
    resize();
    if(spinning) mesh.rotation.y += 0.008;
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }
  animate();

  // expose a function to update texture from product
  window.update3DTexture = function(imgUrl){
    try{
      const loader = new THREE.TextureLoader();
      loader.load(imgUrl, (tex) => {
        mesh.material.map = tex;
        mesh.material.needsUpdate = true;
      });
    } catch(e){ console.warn('texture update failed', e); }
  };
})();

/* When user opens a product modal, update 3D texture to product main image for preview */
function openProductModal(product){
  activeProduct = product;
  modalTitle.textContent = product.name;
  modalBrand.textContent = product.brand + ' • ' + product.category;
  modalPrice.textContent = `₹${product.priceINR.toLocaleString()}`;
  modalOffer.textContent = product.deal ? `${product.deal}% OFF` : 'No offer';
  modalMeta.textContent = `Sizes: ${product.sizes.join(' ')} • SKU: ${product.id}`;
  galleryMainImg.src = product.imgs[0];
  galleryThumbs.innerHTML = '';
  product.imgs.forEach((src,idx)=>{
    const div = document.createElement('div'); div.className = 'thumb' + (idx===0 ? ' active':'' );
    div.innerHTML = `<img src="${src}" loading="lazy" alt="thumb ${idx+1}">`;
    div.addEventListener('click', ()=>{ document.querySelectorAll('.thumb').forEach(t=>t.classList.remove('active')); div.classList.add('active'); galleryMainImg.src = src; });
    galleryThumbs.appendChild(div);
  });
  productModal.classList.add('open'); productModal.setAttribute('aria-hidden','false');
  // update 3D viewer texture
  window.update3DTexture(product.imgs[0]);
}

/* ensure product click handler uses our newly defined openProductModal (override earlier) */
grid.addEventListener('click', (e) => {
  const card = e.target.closest('.card');
  if(!card) return;
  const id = card.dataset.id;
  const p = PRODUCTS.find(x=>x.id===id);
  if(p) openProductModal(p);
});

/* quick close modals with Escape */
document.addEventListener('keydown', (e) => {
  if(e.key === 'Escape'){
    document.querySelectorAll('.modal.open').forEach(m => { m.classList.remove('open'); m.setAttribute('aria-hidden','true'); });
  }
});

/* final UI init */
updateCartUI();

</script>
</body>
</html>
